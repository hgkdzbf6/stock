# ç³»ç»Ÿæµ‹è¯•è¯´æ˜

## ç¯å¢ƒè¦æ±‚
- Python 3.11+
- Node.js 18+
- Docker (å¯é€‰)

## æµ‹è¯•çŠ¶æ€

### âœ… å·²å®Œæˆ
1. åç«¯æœåŠ¡å¯åŠ¨
2. å‰ç«¯æœåŠ¡å¯åŠ¨
3. åç«¯å¥åº·æ£€æŸ¥APIæµ‹è¯•
4. è‚¡ç¥¨åˆ—è¡¨APIæµ‹è¯•
5. æœç´¢APIæµ‹è¯•
6. è‚¡ç¥¨è¯¦æƒ…APIæµ‹è¯•
7. å‰ç«¯Dashboardé¡µé¢åŠ è½½
8. å‰ç«¯Marketé¡µé¢åŠ è½½

### ğŸ”‘ Tokené…ç½®

**é‡è¦**ï¼šTushare Token å·²é…ç½®åˆ° `backend/.env` æ–‡ä»¶ä¸­ï¼Œ**ä¸ä¼šè¢«æäº¤åˆ°Git**ã€‚

è¯¦ç»†çš„é…ç½®è¯´æ˜è¯·æŸ¥çœ‹ï¼š`backend/TUSHARE_CONFIG.md`

**å½“å‰çŠ¶æ€**ï¼š
- âœ… Token å·²é…ç½®åˆ° `backend/.env`
- âœ… `.env` æ–‡ä»¶åœ¨ `.gitignore` ä¸­
- âœ… å…¶ä»–å¼€å‘è€…æ— æ³•çœ‹åˆ°ä½ çš„ token
- âœ… å¯åœ¨ `backend/.env.example` ä¸­çœ‹åˆ°é…ç½®æ¨¡æ¿

**åˆ‡æ¢æ•°æ®æº**ï¼š
```bash
# ç¼–è¾‘ backend/.env æ–‡ä»¶
DATA_SOURCE=tushare  # æˆ– akshare

# é‡å¯åç«¯æœåŠ¡
cd backend
pkill -f "python main.py"
source venv/bin/activate
python main.py
```

### ğŸ“Š APIæµ‹è¯•ç»“æœ

#### 1. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8000/health
```
**ç»“æœ**: âœ… æ­£å¸¸

#### 2. è‚¡ç¥¨åˆ—è¡¨
```bash
curl "http://localhost:8000/api/v1/stocks?page=1&page_size=5"
```
**ç»“æœ**: âœ… æ­£å¸¸ï¼Œè¿”å›mockæ•°æ®ï¼ˆ20åªè‚¡ç¥¨ï¼‰

**ç¤ºä¾‹å“åº”**:
```json
{
  "items": [
    {"ä»£ç ":"000001","åç§°":"å¹³å®‰é“¶è¡Œ","æœ€æ–°ä»·":12.5,"æ¶¨è·Œå¹…":1.25,"æˆäº¤é‡":1000000,"å¸‚å€¼":2425.0},
    {"ä»£ç ":"000002","åç§°":"ä¸‡ç§‘A","æœ€æ–°ä»·":8.75,"æ¶¨è·Œå¹…":-0.34,"æˆäº¤é‡":800000,"å¸‚å€¼":962.5}
  ],
  "total": 20,
  "page": 1,
  "page_size": 5
}
```

#### 3. è‚¡ç¥¨æœç´¢
```bash
curl "http://localhost:8000/api/v1/stocks/search/å¹³å®‰"
```
**ç»“æœ**: âœ… æ­£å¸¸ï¼Œè¿”å›åŒ…å«"å¹³å®‰"çš„è‚¡ç¥¨

**ç¤ºä¾‹å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {"ä»£ç ":"000001","åç§°":"å¹³å®‰é“¶è¡Œ","æœ€æ–°ä»·":12.5,"æ¶¨è·Œå¹…":1.25,"æˆäº¤é‡":1000000,"å¸‚å€¼":2425.0},
    {"ä»£ç ":"601318","åç§°":"ä¸­å›½å¹³å®‰","æœ€æ–°ä»·":42.3,"æ¶¨è·Œå¹…":-0.24,"æˆäº¤é‡":550000,"å¸‚å€¼":7725.0}
  ]
}
```

#### 4. è‚¡ç¥¨è¯¦æƒ…
```bash
curl "http://localhost:8000/api/v1/stocks/000001"
```
**ç»“æœ**: âœ… æ­£å¸¸

### âš ï¸ æ³¨æ„äº‹é¡¹

#### 1. æ•°æ®åº“è¿æ¥
- **çŠ¶æ€**: é…ç½®äº†PostgreSQLä½†æœªå¯åŠ¨
- **å¤„ç†**: ç³»ç»Ÿè‡ªåŠ¨é™çº§ä½¿ç”¨SQLite
- **å½±å“**: æ— å½±å“ï¼Œç³»ç»Ÿæ­£å¸¸è¿è¡Œ

#### 2. Redisè¿æ¥
- **çŠ¶æ€**: Redisæœªå¯åŠ¨
- **å¤„ç†**: ç³»ç»Ÿä½¿ç”¨å†…å­˜ç¼“å­˜
- **å½±å“**: æ— å½±å“ï¼Œç³»ç»Ÿæ­£å¸¸è¿è¡Œ

#### 3. æ•°æ®æº
- **çŠ¶æ€**: akshareè·å–å®æ—¶æ•°æ®å› ä»£ç†é—®é¢˜å¤±è´¥
- **å¤„ç†**: ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨mockæ•°æ®ï¼ˆ20åªå¸¸è§Aè‚¡è‚¡ç¥¨ï¼‰
- **å½±å“**: å‰ç«¯å¯ä»¥æ­£å¸¸æ˜¾ç¤ºå’Œäº¤äº’ï¼Œä½†æ•°æ®ä¸ºæ¨¡æ‹Ÿæ•°æ®

#### 4. Greenletä¾èµ–
- **çŠ¶æ€**: ç¼ºå°‘greenletåº“
- **å½±å“**: æ•°æ®åº“å¼‚æ­¥åŠŸèƒ½å—é™ï¼Œä½†ä¸å½±å“åŸºæœ¬åŠŸèƒ½

### ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

1. âœ… æ·»åŠ äº†ç¼ºå¤±çš„market APIè·¯ç”±
2. âœ… ä¿®å¤äº†å‰ç«¯APIè°ƒç”¨é—®é¢˜
3. âœ… é…ç½®äº†å‰ç«¯ç¯å¢ƒå˜é‡
4. âœ… æ·»åŠ äº†akshareä¾èµ–
5. âœ… ä¿®å¤äº†æ•°æ®åº“é…ç½®
6. âœ… ä¿®å¤äº†CORSé…ç½®
7. âœ… æ·»åŠ äº†mockæ•°æ®fallbackæœºåˆ¶

### ğŸ“ Mockæ•°æ®è¯´æ˜

å½“å‰ç³»ç»Ÿä½¿ç”¨mockæ•°æ®ï¼ŒåŒ…å«ä»¥ä¸‹20åªAè‚¡è‚¡ç¥¨ï¼š

| ä»£ç  | åç§° | ä»£ç  | åç§° |
|------|------|------|------|
| 000001 | å¹³å®‰é“¶è¡Œ | 600000 | æµ¦å‘é“¶è¡Œ |
| 000002 | ä¸‡ç§‘A | 600036 | æ‹›å•†é“¶è¡Œ |
| 600519 | è´µå·èŒ…å° | 000858 | äº”ç²®æ¶² |
| 002415 | æµ·åº·å¨è§† | 000333 | ç¾çš„é›†å›¢ |
| 601318 | ä¸­å›½å¹³å®‰ | 601939 | å»ºè®¾é“¶è¡Œ |
| 600900 | é•¿æ±Ÿç”µåŠ› | 000063 | ä¸­å…´é€šè®¯ |
| 002594 | æ¯”äºšè¿ª | 601012 | éš†åŸºç»¿èƒ½ |
| 600887 | ä¼Šåˆ©è‚¡ä»½ | 600276 | æ’ç‘åŒ»è¯ |
| 000651 | æ ¼åŠ›ç”µå™¨ | 601888 | ä¸­å›½ä¸­å… |
| 601328 | äº¤é€šé“¶è¡Œ | 000725 | äº¬ä¸œæ–¹A |

### ğŸš€ å¯åŠ¨å‘½ä»¤

#### å¯åŠ¨åç«¯
```bash
cd backend
source venv/bin/activate
nohup python main.py > backend.log 2>&1 &
```

#### å¯åŠ¨å‰ç«¯
```bash
cd frontend
npm run dev
```

#### æŸ¥çœ‹åç«¯æ—¥å¿—
```bash
tail -f backend/backend.log
```

### ğŸ“± è®¿é—®åœ°å€

- **å‰ç«¯**: http://localhost:5173
- **åç«¯API**: http://localhost:8000
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

### ğŸ“‹ å¯ç”¨çš„APIç«¯ç‚¹

#### Market API
- `GET /api/v1/market/overview` - å¸‚åœºæ¦‚è§ˆ
- `GET /api/v1/market/sector` - æ¿å—æ•°æ®
- `GET /api/v1/market/stock/{code}/quote` - ä¸ªè‚¡è¡Œæƒ…
- `GET /api/v1/market/stock/{code}/kline` - Kçº¿æ•°æ®

#### Stocks API
- `GET /api/v1/stocks/` - è‚¡ç¥¨åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œæœç´¢ï¼‰
- `GET /api/v1/stocks/{code}` - è‚¡ç¥¨è¯¦æƒ…
- `GET /api/v1/stocks/search/{keyword}` - æœç´¢è‚¡ç¥¨

#### Strategies API
- `GET /api/v1/strategies/` - ç­–ç•¥åˆ—è¡¨
- `POST /api/v1/strategies/backtest` - å›æµ‹ç­–ç•¥

#### Auth API
- `POST /api/v1/auth/register` - æ³¨å†Œ
- `POST /api/v1/auth/login` - ç™»å½•

### ğŸ” æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   cd backend
   source venv/bin/activate
   python main.py
   ```

2. **å¯åŠ¨å‰ç«¯æœåŠ¡**
   ```bash
   cd frontend
   npm run dev
   ```

3. **æµ‹è¯•API**
   ```bash
   # å¥åº·æ£€æŸ¥
   curl http://localhost:8000/health
   
   # è·å–è‚¡ç¥¨åˆ—è¡¨
   curl "http://localhost:8000/api/v1/stocks?page=1&page_size=10"
   
   # æœç´¢è‚¡ç¥¨
   curl "http://localhost:8000/api/v1/stocks/search/èŒ…å°"
   
   # è·å–è‚¡ç¥¨è¯¦æƒ…
   curl "http://localhost:8000/api/v1/stocks/000001"
   ```

4. **æ‰“å¼€æµè§ˆå™¨**
   - è®¿é—®å‰ç«¯: http://localhost:5173
   - è®¿é—®APIæ–‡æ¡£: http://localhost:8000/docs

### ğŸ“Œ å‰åç«¯è”è°ƒéªŒè¯

1. âœ… Dashboardé¡µé¢åº”è¯¥æ˜¾ç¤ºå¸‚åœºæ¦‚è§ˆæ•°æ®
2. âœ… Marketé¡µé¢åº”è¯¥æ˜¾ç¤ºè‚¡ç¥¨åˆ—è¡¨
3. âœ… æœç´¢åŠŸèƒ½åº”è¯¥å¯ä»¥æœç´¢è‚¡ç¥¨
4. âœ… ç‚¹å‡»è‚¡ç¥¨åº”è¯¥æ˜¾ç¤ºè‚¡ç¥¨è¯¦æƒ…

### ğŸ› ï¸ å¸¸è§é—®é¢˜

1. **CORSé”™è¯¯**
   - ç¡®ä¿åç«¯çš„ CORS é…ç½®åŒ…å«å‰ç«¯åœ°å€
   - å·²åœ¨ `backend/.env` ä¸­é…ç½®ï¼š`CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173`

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - å½“å‰ä½¿ç”¨SQLiteï¼Œæ•°æ®åº“æ–‡ä»¶åœ¨ `backend/stock.db`
   - æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥ä¼šä½¿ç”¨å†…å­˜ç¼“å­˜ï¼Œä¸å½±å“APIæµ‹è¯•

3. **Redisè¿æ¥å¤±è´¥**
   - Redisæœªå¯åŠ¨ä¼šè‡ªåŠ¨ä½¿ç”¨å†…å­˜ç¼“å­˜
   - ä¸å½±å“åŸºæœ¬åŠŸèƒ½æµ‹è¯•

4. **æ•°æ®ä¸ºç©º**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨mockæ•°æ®
   - å¯ä»¥åœ¨ `backend/services/data_fetcher.py` ä¸­ä¿®æ”¹mockæ•°æ®

### ğŸ“ ä»£ç ä¿®æ”¹æ€»ç»“

#### åç«¯ä¿®æ”¹
1. âœ… æ·»åŠ äº† akshare æ•°æ®æºä¾èµ–
2. âœ… ä¿®å¤äº† CORS_ORIGINS é…ç½®ç±»å‹é—®é¢˜
3. âœ… ä¿®æ”¹ database.py æ”¯æŒæ•°æ®åº“è‡ªåŠ¨é™çº§
4. âœ… ä¿®å¤äº†ç«¯å£é…ç½®çš„ç±»å‹é—®é¢˜
5. âœ… æ·»åŠ äº† aiosqlite å’Œ email-validator ä¾èµ–
6. âœ… åœ¨data_fetcherä¸­æ·»åŠ äº†mockæ•°æ®fallbackæœºåˆ¶

#### å‰ç«¯ä¿®æ”¹
1. âœ… ä¿®æ”¹ Dashboard.tsx è°ƒç”¨çœŸå®APIï¼ˆç§»é™¤mockæ•°æ®ï¼‰
2. âœ… ä¿®æ”¹ Market.tsx è°ƒç”¨çœŸå®APIï¼ˆç§»é™¤mockæ•°æ®ï¼‰
3. âœ… åˆ›å»ºäº† .env ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
4. âœ… StockService ä½¿ç”¨çœŸå®çš„APIç«¯ç‚¹

### ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - å®‰è£… greenlet: `pip install greenlet`
   - é…ç½®PostgreSQLæˆ–MySQLç”Ÿäº§ç¯å¢ƒæ•°æ®åº“

2. **ç¼“å­˜ä¼˜åŒ–**
   - å¯åŠ¨RedisæœåŠ¡æä¾›æŒä¹…åŒ–ç¼“å­˜

3. **ä¾èµ–æ¸…ç†**
   - ä¿®å¤FastAPIçš„regexå‚æ•°å·²å¼ƒç”¨çš„è­¦å‘Šï¼ˆä½¿ç”¨patternæ›¿ä»£ï¼‰

4. **æ•°æ®æºä¼˜åŒ–**
   - é…ç½® akshare æˆ– tushare çš„API token
   - æµ‹è¯•çœŸå®æ•°æ®è·å–åŠŸèƒ½
   - è§£å†³ç½‘ç»œä»£ç†é—®é¢˜

5. **åŠŸèƒ½å®Œå–„**
   - å®ç°çœŸå®çš„è‚¡ç¥¨æ•°æ®è·å–
   - å®Œå–„ç­–ç•¥å›æµ‹åŠŸèƒ½
   - æ·»åŠ ç”¨æˆ·è®¤è¯åŠŸèƒ½